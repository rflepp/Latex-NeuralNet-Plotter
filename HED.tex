\documentclass[border=15pt, multi, tikz]{standalone}
\usepackage{import}
\subimport{./layers/}{init}
\usetikzlibrary{positioning}

\def\ConvColor{rgb:yellow,5;red,2.5;white,5}
\def\ConvReluColor{rgb:yellow,5;red,5;white,5}
\def\PoolColor{rgb:red,1;black,0.3}
\def\DcnvColor{rgb:blue,5;green,2.5;white,3}
\def\SoftmaxColor{rgb:magenta,5;black,7}
\def\SumColor{rgb:blue,5;green,15}
\def\SkipColor{rgb:blue,2;red,1;white,10}
\def\poolsep{1}

\begin{document}
\begin{tikzpicture}
\tikzstyle{connection}=[ultra thick,every node/.style={sloped,allow upside down},draw=\edgecolor,opacity=0.6]
\tikzstyle{skip}=[ultra thick,every node/.style={sloped,allow upside down},draw=\edgecolor,opacity=1.0]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Draw Layer Blocks
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Input layer
\pic[shift={(0,0,0)}] at (0,0,0) {Box={name=input,%
        xlabel={{"3",}},zlabel=I,fill=blue!50,%
        height=40,width=2,depth=40}};

% conv1
\pic[shift={(1.5,0,0)}] at (input-east) {RightBandedBox={name=conv1,%
        xlabel={{"32",}},zlabel=I,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=40,width=4,depth=40}};

% conv2
\pic[shift={(2.5,0,5)}] at (conv1-east) {RightBandedBox={name=conv2_1,%
        xlabel={{"32",}},zlabel=I/2,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=30,width=4,depth=20}};
\pic[shift={(2.5,0,-5)}] at (conv1-east) {RightBandedBox={name=conv2_2,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=30,width=4,depth=20}};

% conv3
\pic[shift={(3,0,2.5)}] at (conv2_1-east) {RightBandedBox={name=conv3_1_1,%
        xlabel={{"32",}},zlabel=I/4,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=20,width=4,depth=10}};
\pic[shift={(3,0,-2.5)}] at (conv2_1-east) {RightBandedBox={name=conv3_1_2,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=20,width=4,depth=10}};
\pic[shift={(3,0,2.5)}] at (conv2_2-east) {RightBandedBox={name=conv3_2_1,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=20,width=4,depth=10}};
\pic[shift={(3,0,-2.5)}] at (conv2_2-east) {RightBandedBox={name=conv3_2_2,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=20,width=4,depth=10}};

% conv4
\pic[shift={(3,0,1.25)}] at (conv3_1_1-east) {RightBandedBox={name=conv4_1_1,%
        xlabel={{"32",}},zlabel=I/8,fill=\ConvColor,bandfill=\ConvReluColor,%
        height=10,width=4,depth=5}};
\pic[shift={(3,0,-1.25)}] at (conv3_1_1-east) {RightBandedBox={name=conv4_1_2,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=10,width=4,depth=5}};
\pic[shift={(3,0,1.25)}] at (conv3_1_2-east) {RightBandedBox={name=conv4_2_1,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=10,width=4,depth=5}};
\pic[shift={(3,0,-1.25)}] at (conv3_1_2-east) {RightBandedBox={name=conv4_2_2,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=10,width=4,depth=5}};
\pic[shift={(3,0,1.25)}] at (conv3_2_1-east) {RightBandedBox={name=conv4_3_1,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=10,width=4,depth=5}};
\pic[shift={(3,0,-1.25)}] at (conv3_2_1-east) {RightBandedBox={name=conv4_3_2,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=10,width=4,depth=5}};
\pic[shift={(3,0,1.25)}] at (conv3_2_2-east) {RightBandedBox={name=conv4_4_1,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=10,width=4,depth=5}};
\pic[shift={(3,0,-1.25)}] at (conv3_2_2-east) {RightBandedBox={name=conv4_4_2,%
        fill=\ConvColor,bandfill=\ConvReluColor,%
        height=10,width=4,depth=5}};

% mid block
\pic[shift={(3,0,0.625)}] at (conv4_1_1-east) {Box={name=mid1,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
\pic[shift={(3,0,-0.625)}] at (conv4_1_1-east) {Box={name=mid2,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
        
\pic[shift={(3,0,0.625)}] at (conv4_1_2-east) {Box={name=mid3,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
\pic[shift={(3,0,-0.625)}] at (conv4_1_2-east) {Box={name=mid4,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
        
\pic[shift={(3,0,0.625)}] at (conv4_2_1-east) {Box={name=mid5,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
\pic[shift={(3,0,-0.625)}] at (conv4_2_1-east) {Box={name=mid6,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};

\pic[shift={(3,0,0.625)}] at (conv4_2_2-east) {Box={name=mid7,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
\pic[shift={(3,0,-0.625)}] at (conv4_2_2-east) {Box={name=mid8,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
        
\pic[shift={(3,0,0.625)}] at (conv4_3_1-east) {Box={name=mid9,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
\pic[shift={(3,0,-0.625)}] at (conv4_3_1-east) {Box={name=mid10,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};

\pic[shift={(3,0,0.625)}] at (conv4_3_2-east) {Box={name=mid11,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
\pic[shift={(3,0,-0.625)}] at (conv4_3_2-east) {Box={name=mid12,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
        
\pic[shift={(3,0,0.625)}] at (conv4_4_1-east) {Box={name=mid13,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
\pic[shift={(3,0,-0.625)}] at (conv4_4_1-east) {Box={name=mid14,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
        
\pic[shift={(3,0,0.625)}] at (conv4_4_2-east) {Box={name=mid15,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
\pic[shift={(3,0,-0.625)}] at (conv4_4_2-east) {Box={name=mid16,%
        fill=green!20,opacity=0.5,height=5,width=4,depth=2}};
        
% decoder
% 4th stage
\pic[shift={(6,0,0)}] at (conv4_1_1-east) {RightBandedBox={name=decode1_1,%
        xlabel={{"32",}},zlabel=I/8,fill=\DcnvColor,opacity=0.5,height=10,width=4,depth=5}};
\pic[shift={(6,0,0)}] at (conv4_1_2-east) {RightBandedBox={name=decode1_2,%
        fill=\DcnvColor,opacity=0.5,height=10,width=4,depth=5}};
\pic[shift={(6,0,0)}] at (conv4_2_1-east) {RightBandedBox={name=decode1_3,%
        fill=\DcnvColor,opacity=0.5,height=10,width=4,depth=5}};
\pic[shift={(6,0,0)}] at (conv4_2_2-east) {RightBandedBox={name=decode1_4,%
        fill=\DcnvColor,opacity=0.5,height=10,width=4,depth=5}};
\pic[shift={(6,0,0)}] at (conv4_3_1-east) {RightBandedBox={name=decode1_5,%
        fill=\DcnvColor,opacity=0.5,height=10,width=4,depth=5}};
\pic[shift={(6,0,0)}] at (conv4_3_2-east) {RightBandedBox={name=decode1_6,%
        fill=\DcnvColor,opacity=0.5,height=10,width=4,depth=5}};
\pic[shift={(6,0,0)}] at (conv4_4_1-east) {RightBandedBox={name=decode1_7,%
        fill=\DcnvColor,opacity=0.5,height=10,width=4,depth=5}};
\pic[shift={(6,0,0)}] at (conv4_4_2-east) {RightBandedBox={name=decode1_8,%
        fill=\DcnvColor,opacity=0.5,height=10,width=4,depth=5}};

% 3rd stage
\pic[shift={(14,0,0)}] at (conv3_1_1-east) {RightBandedBox={name=decode2_2,%
        xlabel={{"32",}},zlabel=I/4,fill=\DcnvColor,opacity=0.5,height=20,width=4,depth=10}};
\pic[shift={(14,0,0)}] at (conv3_1_2-east) {RightBandedBox={name=decode2_4,%
        fill=\DcnvColor,opacity=0.5,height=20,width=4,depth=10}};
\pic[shift={(14,0,0)}] at (conv3_2_1-east) {RightBandedBox={name=decode2_6,%
        fill=\DcnvColor,opacity=0.5,height=20,width=4,depth=10}};
\pic[shift={(14,0,0)}] at (conv3_2_2-east) {RightBandedBox={name=decode2_8,%
        fill=\DcnvColor,opacity=0.5,height=20,width=4,depth=10}};

% 2nd stage
\pic[shift={(3,0,2)}] at (decode2_4-east) {RightBandedBox={name=decode3_1,%
        xlabel={{"32",}},zlabel=I/2,fill=\DcnvColor,opacity=0.5,height=30,width=4,depth=20}};
\pic[shift={(3,0,-2)}] at (decode2_6-east) {RightBandedBox={name=decode3_2,%
        fill=\DcnvColor,opacity=0.5,height=30,width=4,depth=20}};

% 1st stage
\pic[shift={(32,0,0)}] at (input-east) {RightBandedBox={name=decode4_1,%
        xlabel={{"32",}},zlabel=I,fill=\DcnvColor,opacity=0.5,height=40,width=4,depth=40}};

% Output
\pic[shift={(2,0,0)}] at (decode4_1-east) {Box={name=output,%
        xlabel={{"3",}},zlabel=I,fill=blue!50,%
        height=40,width=2,depth=40}};

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Draw connections
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\draw[connection] (input-east) -- node {\midarrow} (conv1-west);
\draw[connection] (conv1-east) -- node {\midarrow} (conv2_1-west);
\draw[connection] (conv1-east) -- node {\midarrow} (conv2_2-west);
\draw[connection] (conv2_1-east) -- node {\midarrow} (conv3_1_1-west);
\draw[connection] (conv2_1-east) -- node {\midarrow} (conv3_1_2-west);
\draw[connection] (conv2_2-east) -- node {\midarrow} (conv3_2_1-west);
\draw[connection] (conv2_2-east) -- node {\midarrow} (conv3_2_2-west);
\draw[connection] (conv3_1_1-east) -- node {\midarrow} (conv4_1_1-west);
\draw[connection] (conv3_1_1-east) -- node {\midarrow} (conv4_1_2-west);
\draw[connection] (conv3_1_2-east) -- node {\midarrow} (conv4_2_1-west);
\draw[connection] (conv3_1_2-east) -- node {\midarrow} (conv4_2_2-west);
\draw[connection] (conv3_2_1-east) -- node {\midarrow} (conv4_3_1-west);
\draw[connection] (conv3_2_1-east) -- node {\midarrow} (conv4_3_2-west);
\draw[connection] (conv3_2_2-east) -- node {\midarrow} (conv4_4_1-west);
\draw[connection] (conv3_2_2-east) -- node {\midarrow} (conv4_4_2-west);
\draw[connection] (conv4_1_1-east) -- node {\midarrow} (mid1-west);
\draw[connection] (conv4_1_1-east) -- node {\midarrow} (mid2-west);
\draw[connection] (conv4_1_2-east) -- node {\midarrow} (mid3-west);
\draw[connection] (conv4_1_2-east) -- node {\midarrow} (mid4-west);
\draw[connection] (conv4_2_1-east) -- node {\midarrow} (mid5-west);
\draw[connection] (conv4_2_1-east) -- node {\midarrow} (mid6-west);
\draw[connection] (conv4_2_2-east) -- node {\midarrow} (mid7-west);
\draw[connection] (conv4_2_2-east) -- node {\midarrow} (mid8-west);
\draw[connection] (conv4_3_1-east) -- node {\midarrow} (mid9-west);
\draw[connection] (conv4_3_1-east) -- node {\midarrow} (mid10-west);
\draw[connection] (conv4_3_2-east) -- node {\midarrow} (mid11-west);
\draw[connection] (conv4_3_2-east) -- node {\midarrow} (mid12-west);
\draw[connection] (conv4_4_1-east) -- node {\midarrow} (mid13-west);
\draw[connection] (conv4_4_1-east) -- node {\midarrow} (mid14-west);
\draw[connection] (conv4_4_2-east) -- node {\midarrow} (mid15-west);
\draw[connection] (conv4_4_2-east) -- node {\midarrow} (mid16-west);
\draw[connection] (mid1-east) -- node {\midarrow} (decode1_1-west);
\draw[connection] (mid2-east) -- node {\midarrow} (decode1_1-west);
\draw[connection] (mid3-east) -- node {\midarrow} (decode1_2-west);
\draw[connection] (mid4-east) -- node {\midarrow} (decode1_2-west);
\draw[connection] (mid5-east) -- node {\midarrow} (decode1_3-west);
\draw[connection] (mid6-east) -- node {\midarrow} (decode1_3-west);
\draw[connection] (mid7-east) -- node {\midarrow} (decode1_4-west);
\draw[connection] (mid8-east) -- node {\midarrow} (decode1_4-west);
\draw[connection] (mid9-east) -- node {\midarrow} (decode1_5-west);
\draw[connection] (mid10-east) -- node {\midarrow} (decode1_5-west);
\draw[connection] (mid11-east) -- node {\midarrow} (decode1_6-west);
\draw[connection] (mid12-east) -- node {\midarrow} (decode1_6-west);
\draw[connection] (mid13-east) -- node {\midarrow} (decode1_7-west);
\draw[connection] (mid14-east) -- node {\midarrow} (decode1_7-west);
\draw[connection] (mid15-east) -- node {\midarrow} (decode1_8-west);
\draw[connection] (mid16-east) -- node {\midarrow} (decode1_8-west);
\draw[connection] (decode1_1-east) -- node {\midarrow} (decode2_2-west);
\draw[connection] (decode1_2-east) -- node {\midarrow} (decode2_2-west);
\draw[connection] (decode1_3-east) -- node {\midarrow} (decode2_4-west);
\draw[connection] (decode1_4-east) -- node {\midarrow} (decode2_4-west);
\draw[connection] (decode1_5-east) -- node {\midarrow} (decode2_6-west);
\draw[connection] (decode1_6-east) -- node {\midarrow} (decode2_6-west);
\draw[connection] (decode1_7-east) -- node {\midarrow} (decode2_8-west);
\draw[connection] (decode1_8-east) -- node {\midarrow} (decode2_8-west);
\draw[connection] (decode2_2-east) -- node {\midarrow} (decode3_1-west);
\draw[connection] (decode2_4-east) -- node {\midarrow} (decode3_1-west);
\draw[connection] (decode2_6-east) -- node {\midarrow} (decode3_2-west);
\draw[connection] (decode2_8-east) -- node {\midarrow} (decode3_2-west);
\draw[connection] (decode3_1-east) -- node {\midarrow} (decode4_1-west);
\draw[connection] (decode3_2-east) -- node {\midarrow} (decode4_1-west);
\draw[connection] (decode4_1-east) -- node {\midarrow} (output-west);


% Skip connection from input layer to the output layer
\path (input-near) -- ++(0,0,22) coordinate (skip_up_input) -- ++(35,0,0) coordinate (skip_right_input) -- ++(0,0,-22) coordinate (skip_down_input);
\draw[skip] (input-near) -- (skip_up_input) -- (skip_right_input) -- (skip_down_input) -- node {\midarrow} (output-near);

% Skip connection from conv1 to decode4_1
\path (conv1-near) -- ++(0,0,20) coordinate (skip_up_conv1) -- ++(30,0,0) coordinate (skip_right_conv1) -- ++(0,0,-20) coordinate (skip_down_conv1);
\draw[skip] (conv1-near) -- (skip_up_conv1) -- (skip_right_conv1) -- (skip_down_conv1) -- node {\midarrow} (decode4_1-near);

% Skip connection from conv2_1 to decode3_1
\path (conv2_1-near) -- ++(0,0,15) coordinate (skip_up_conv2_1) -- ++(22,0,0) coordinate (skip_right_conv2_1) -- ++(0,0,-15) coordinate (skip_down_conv2_1);
\draw[skip] (conv2_1-near) -- (skip_up_conv2_1) -- (skip_right_conv2_1) -- (skip_down_conv2_1) -- node {\midarrow} (decode3_1-near);

% Skip connection from conv3_1_1 to decode2_2
\path (conv3_1_1-near) -- ++(0,0,10) coordinate (skip_up_conv3_1_1) -- ++(14,0,0) coordinate (skip_right_conv3_1_1) -- ++(0,0,-10) coordinate (skip_down_conv3_1_1);
\draw[skip] (conv3_1_1-near) -- (skip_up_conv3_1_1) -- (skip_right_conv3_1_1) -- (skip_down_conv3_1_1) -- node {\midarrow} (decode2_2-near);

% Skip connection from conv4_1_1 to decode1_1
\path (conv4_1_1-near) -- ++(0,0,6) coordinate (skip_up_conv4_1_1) -- ++(7,0,0) coordinate (skip_right_conv4_1_1) -- ++(0,0,-6) coordinate (skip_down_conv4_1_1);
\draw[skip] (conv4_1_1-near) -- (skip_up_conv4_1_1) -- (skip_right_conv4_1_1) -- (skip_down_conv4_1_1) -- node {\midarrow} (decode1_1-near);




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\end{tikzpicture}
\end{document}
